<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>friendFinder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">
  <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <!-- <script src="../routing/htmlRoutes.js"></script> -->
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="jumbotron">
        <h2 class="display-4">friendFinder</h2>
        <h1 class="display-4">Survey.</h1>
        <p class="lead">Answer the following questions to find a match</p>
        <hr class="my-4">
        <form>
          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" class="form-control" id="name" placeholder="Enter name">
          </div>
          <div class="form-group">
            <label for="name">Slack ID</label>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">#</span>
              </div>
              <input type="text" class="form-control" id="slack-id" placeholder="Enter Slack ID">
            </div>
        </form>

        <div id="question-box"></div>
        <a class="btn btn-primary btn-lg" id="survey-submit" role="button">Find a Match.</a>
      </div>
    </div>
  </div>
</body>
<style type="text/css">
.selector {
  width: 80%;
  margin: auto;
}

</style>
<script type="text/javascript">

  var questionArray = [
    "You can do anything you set your mind to.",
    "People don't know how to drive in Atlanta.",
    "Anthropogenic climate change is real.",
    "Donald Trump is a deranged madman.",
    "More can be accomplished when people work together.",
    "Healthcare should be a universal right.",
    "You frequently think people are talking behind your back.",
  ];

  var options = [
    "-Select an Answer-",
    "Strongly Agree",
    "Agree",
    "Neutral",
    "Disagree",
    "Strongly Disagree"
  ];

  for (i = 1; i < questionArray.length + 1; i++) {

    var question = $(`<div>`);
    question.attr("class", "card mb-3")
      .html(`
    <div class="card-body" id="question${i}">
      <h5 class="card-title">${questionArray[i - 1]}</h5>
      <select class="selector" id="selector${i}"></select>
    </div>
    </div
    `);

    $(`#question-box`).append(question);

    var selector = $(`#selector${i}`)

    for (var a = 0; a < options.length; a++) {

      var opt = options[a];
      var el = $(`<option>`);
      el.text(opt);
      el.attr(`value`, a);
      selector.append(el);
    };
  };

  $(`#survey-submit`).click(function () {

    event.preventDefault();

    var scoreArray = [];

    for (i = 1; i < 11; i++) {
      var score = $(`#selector${i} option:selected`).val();

      // if (score === null) {
      //   console.log(`Quesiton #${i} has a null selection.`);
      //   scoreArray.push(``);
      // } else {
      scoreArray.push(score);
      // };
    }

    var newFriend = {
      "name": $("#name").val().trim(),
      "slackID": $("#slack-id").val().trim(),
      "scores": scoreArray
    };

    $.post(`/api/friends`, newFriend)
      .then((data) => {
        // console.log(data);
      });

    $.get(`api/friends`, (data) => {
      console.log(data);
      console.log(`There are ${data.length} friends in the system.`);
      findMatch(data, data[data.length - 1]);
    })
  })

  function findMatch(allData, yourData) {
    console.log(`Here are the possible friends`);

    for (i = 0; i < allData.length - 1; i++) {
      console.log(allData[i].name);
      console.log(allData[i].scores);
    }
    console.log(`******`);
    console.log(yourData.name);
    console.log(yourData.scores);

  }


</script>

</html>